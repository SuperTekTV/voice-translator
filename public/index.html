<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Traduttore con Sintesi Vocale</title>
</head>
<body>
  <h1>Traduttore con Sintesi Vocale</h1>

  <textarea id="inputText" rows="5" cols="40" placeholder="Inserisci testo da tradurre"></textarea>
  <br />

  <label for="sourceLang">Lingua sorgente:</label>
  <input id="sourceLang" type="text" value="it" size="2" />
  <br />

  <label for="targetLang">Lingua destinazione:</label>
  <input id="targetLang" type="text" value="en" size="2" />
  <br />

  <button id="translateBtn">Traduci</button>

  <h3>Testo tradotto:</h3>
  <textarea id="outputText" rows="5" cols="40" readonly></textarea>

  <script>
    async function speak(text, lang) {
      return new Promise((resolve) => {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;

        utterance.onend = () => resolve();
        utterance.onerror = () => resolve();

        speechSynthesis.speak(utterance);
      });
    }

    document.getElementById('translateBtn').addEventListener('click', async () => {
      const text = document.getElementById('inputText').value.trim();
      const source = document.getElementById('sourceLang').value.trim();
      const target = document.getElementById('targetLang').value.trim();

      if (!text) {
        alert('Inserisci il testo da tradurre');
        return;
      }

      try {
        const response = await fetch('/api/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, source, target }),
        });

        const data = await response.json();

        if (data.translatedText) {
          document.getElementById('outputText').value = data.translatedText;
          await speak(data.translatedText, target);
        } else {
          alert('Errore durante la traduzione');
        }
      } catch (err) {
        console.error(err);
        alert('Errore durante la traduzione');
      }
    });
  </script>
</body>
</html>
